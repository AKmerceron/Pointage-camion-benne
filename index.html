<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Pointage Camions</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial, sans-serif; background:#f5f5f5; margin:0; }
    .container { max-width:600px; margin:20px auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    h1 { text-align:center; color:#1a73e8; margin-bottom:5px; }
    h1 span { margin-right:5px; }
    .subtitle { text-align:center; color:#777; margin-bottom:20px; }
    .clock { text-align:center; background:#eaf2ff; padding:15px; border-radius:8px; margin-bottom:20px; }
    .clock-label { font-size:12px; letter-spacing:1px; color:#777; }
    .clock-time { font-size:28px; font-weight:bold; color:#1a73e8; }
    label { display:block; margin-top:10px; font-weight:bold; font-size:14px; }
    input, textarea { width:100%; padding:10px; margin-top:5px; box-sizing:border-box; border:1px solid #ccc; border-radius:6px; font-size:14px; }
    textarea { resize:vertical; min-height:60px; }
    .buttons { display:flex; gap:10px; margin-top:20px; }
    .btn { flex:1; padding:12px; border:none; border-radius:6px; font-size:16px; cursor:pointer; color:#fff; }
    .btn-primary { background:#1a73e8; }
    .btn-secondary { background:#b0b0b0; }
    .btn-excel { width:100%; margin-top:15px; background:#2e7d32; color:#fff; padding:12px; border:none; border-radius:6px; font-size:16px; cursor:pointer; }
    .message { margin-top:10px; color:green; font-size:14px; }

    /* zone tombereaux (nouvelle partie) */
    .tombereaux { display:flex; gap:10px; margin-top:10px; }
    .tombereaux button {
      flex:1;
      padding:10px;
      border-radius:6px;
      border:1px solid #1a73e8;
      background:#fff;
      color:#1a73e8;
      font-weight:bold;
      cursor:pointer;
    }
    .tombereaux button.selected {
      background:#1a73e8;
      color:#fff;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1><span>ðŸšš</span>Pointage Camions</h1>
    <div class="subtitle">Saisie simple et rapide des passages</div>

    <div class="clock">
      <div class="clock-label">HEURE ACTUELLE</div>
      <div id="clock" class="clock-time">--:--:--</div>
    </div>

    <!-- Partie tombereaux comme sur ton schÃ©ma -->
    <label>Tombereau</label>
    <div class="tombereaux">
      <button type="button" onclick="choisirTombereau('Tombereau nÂ°1', this)">Tombereau nÂ°1</button>
      <button type="button" onclick="choisirTombereau('Tombereau nÂ°2', this)">Tombereau nÂ°2</button>
      <button type="button" onclick="choisirTombereau('Tombereau nÂ°3', this)">Tombereau nÂ°3</button>
    </div>

    <!-- Champ cachÃ© ou Ã©ditable qui contient la valeur exacte envoyÃ©e dans le CSV -->
    <input type="hidden" id="camion">

    <label>Heure de passage</label>
    <input type="time" id="heure">

    <label>Notes (optionnel)</label>
    <textarea id="notes" placeholder="Ex: Livraison, Retrait, Panne..."></textarea>

    <div class="buttons">
      <button class="btn btn-primary" onclick="enregistrer()">Enregistrer</button>
      <button class="btn btn-secondary" onclick="effacer()">Effacer</button>
    </div>

    <button class="btn-excel" onclick="telechargerCSV()">ðŸ“¥ TÃ©lÃ©charger en Excel</button>

    <div class="message" id="message"></div>
  </div>

  <script>
    let donnees = [];

    function majHorloge() {
      const maintenant = new Date();
      const h = String(maintenant.getHours()).padStart(2, '0');
      const m = String(maintenant.getMinutes()).padStart(2, '0');
      const s = String(maintenant.getSeconds()).padStart(2, '0');
      document.getElementById('clock').textContent = `${h} : ${m} : ${s}`;
    }
    setInterval(majHorloge, 1000);
    majHorloge();

    // sÃ©lection du tombereau
    function choisirTombereau(valeur, bouton) {
      document.getElementById('camion').value = valeur;
      // visuel sÃ©lectionnÃ©
      const tous = document.querySelectorAll('.tombereaux button');
      tous.forEach(b => b.classList.remove('selected'));
      bouton.classList.add('selected');
    }

    function enregistrer() {
      const nom = document.getElementById('nom').value.trim();
      const camion = document.getElementById('camion').value.trim();
      let heurePassage = document.getElementById('heure').value;
      const notes = document.getElementById('notes').value.trim();

      if (!nom || !camion) {
        alert('Nom et tombereau sont obligatoires.');
        return;
      }

      const maintenant = new Date();
      const date = maintenant.toISOString().split('T')[0];
      if (!heurePassage) {
        const h = String(maintenant.getHours()).padStart(2, '0');
        const m = String(maintenant.getMinutes()).padStart(2, '0');
        heurePassage = `${h}:${m}`;
      }

      donnees.push({
        date,
        heure: heurePassage,
        nom,
        camion,
        notes
      });

      document.getElementById('message').textContent =
        `Passage enregistrÃ© : ${date} ${heurePassage} - ${nom} - ${camion}`;
    }

    function effacer() {
      document.getElementById('nom').value = '';
      document.getElementById('camion').value = '';
      document.getElementById('heure').value = '';
      document.getElementById('notes').value = '';
      document.getElementById('message').textContent = '';
      const tous = document.querySelectorAll('.tombereaux button');
      tous.forEach(b => b.classList.remove('selected'));
    }

    function telechargerCSV() {
      if (donnees.length === 0) {
        alert('Aucune donnÃ©e Ã  exporter.');
        return;
      }
      let csv = 'Date;Heure;Nom;Tombereau;Notes\n';
      donnees.forEach(ligne => {
        csv += `${ligne.date};${ligne.heure};${ligne.nom};${ligne.camion};${ligne.notes}\n`;
      });
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'pointage_camions.csv';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
